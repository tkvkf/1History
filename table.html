<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연표</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div>
        <button onclick="goHome()">처음으로</button>
    </div>
    <br>
    <div class="tag-container">
        <label class="-box"><input type="checkbox" name="tags" value="17"> 학습지 17번</label>
        <label class="box"><input type="checkbox" name="tags" value="18"> 학습지 18번</label>
        <label class="box"><input type="checkbox" name="tags" value="19"> 학습지 19번</label>
        <label class="box"><input type="checkbox" name="tags" value="20"> 학습지 20번</label>
        <label class="box"><input type="checkbox" name="tags" value="21"> 학습지 21번</label>
        <label class="box"><input type="checkbox" name="tags" value="22"> 학습지 22번</label>
        <label class="box"><input type="checkbox" name="tags" value="23"> 학습지 23번</label>
        <label class="box"><input type="checkbox" name="tags" value="24"> 학습지 24번</label>
        <label class="box"><input type="checkbox" name="tags" value="25"> 학습지 25번</label>
    </div>
    <br>
    <div>
        <label>기간 선택 : <input type="number" id="startYear" min="1890" max="2000" value="1890"></label>
        <label> ~ <input type="number" id="endYear" min="1890" max="2000" value="2000"></label>
    </div>
    <br>
    <div>
        <button onclick="filter()">필터 적용</button>
    </div>
    <br>
    <div id="table-box">
        <div id="table"></div>
    </div>

    <script>
        let Data = [];
        let filtered = [];

        fetch("data.json")
            .then(response => response.json())
            .then(data => {
                Data = data;
                filtered = [...Data];
                renderTable(filtered);
            })
            .catch(error => {
                console.error('데이터 로드 실패:', error);
                document.getElementById('table').textContent = "데이터를 불러오는 데 실패했습니다.";
            });

        function padMonth(str) {
            const [y, m] = String(str).split(".");
            return m ? `${y}.${parseInt(m)}` : `${y}`;
        }

        function parseYearMonth(str) {
            const [y, m] = String(str).split(".");
            return {
                year: parseInt(y, 10),
                month: m !== undefined ? parseInt(m, 10) : 0
            };
        }

        function renderTable(data) {
            if (!data.length) {
                document.getElementById('table').innerHTML = "<div>해당 조건의 요소가 없습니다.</div>";
                return;
            }
            data.sort((a, b) => {
                const ay = parseYearMonth(a.year);
                const by = parseYearMonth(b.year);
                if (ay.year !== by.year) return ay.year - by.year;
                return ay.month - by.month;
            });

            let html = `<table>
        <tr>
            <th style="text-align:left; color:#66cc33;">연도</th>
            <th style="color:#66cc33;">사건</th>
            <th style="text-align:right; color:#66cc33;">학습지</th>
        </tr>`;
            data.forEach(item => {
                html += `<tr>
            <td style="text-align:left;">${padMonth(item.year)}</td>
            <td>${item.event || ""}</td>
            <td style="text-align:right;">${item.tags}</td>
        </tr>`;
            });
            html += `</table>`;
            document.getElementById('table').innerHTML = html;
        }

        function filter() {
            const checked = Array.from(document.querySelectorAll('input[name="tags"]:checked')).map(cb => cb.value);
            const startYear = document.getElementById('startYear').value;
            const endYear = document.getElementById('endYear').value;
            const startYearStr = startYear.includes('.') ? padMonth(startYear) : `${startYear}.00`;
            const endYearStr = endYear.includes('.') ? padMonth(endYear) : `${endYear}.12`;

            filtered = Data.filter(item => {
                const tagMatch = checked.length === 0 || checked.includes(String(item.tags));
                const y = padMonth(item.year);
                return tagMatch && y >= startYearStr && y <= endYearStr;
            });

            renderTable(filtered);
        }

        function getQueryParams() {
            const params = {};
            const searchParams = new URLSearchParams(location.search);
            for (const [key, value] of searchParams.entries()) {
                params[key] = value;
            }
            return params;
        }

        function goHome() {
            window.location.href = "index.html";
        }
    </script>
</body>

</html>