<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연표</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div>
        <button onclick="goHome()">처음으로</button>
    </div>
    <br>
    <div class="tag-container">
        <label class="-box"><input type="checkbox" name="tags" value="1"> 학습지 1번</label>
        <label class="-box"><input type="checkbox" name="tags" value="2"> 학습지 2번</label>
        <label class="-box"><input type="checkbox" name="tags" value="3"> 학습지 3번</label>
        <label class="-box"><input type="checkbox" name="tags" value="4"> 학습지 4번</label>
        <label class="-box"><input type="checkbox" name="tags" value="5"> 학습지 5번</label>
        <label class="-box"><input type="checkbox" name="tags" value="6"> 학습지 6번</label>
        <label class="-box"><input type="checkbox" name="tags" value="7"> 학습지 7번</label>
        <label class="-box"><input type="checkbox" name="tags" value="8"> 학습지 8번</label>
        <label class="-box"><input type="checkbox" name="tags" value="9"> 학습지 9번</label>
        <label class="-box"><input type="checkbox" name="tags" value="10"> 학습지 10번</label>
        <label class="-box"><input type="checkbox" name="tags" value="11"> 학습지 11번</label>
        <label class="-box"><input type="checkbox" name="tags" value="12"> 학습지 12번</label>
        <label class="-box"><input type="checkbox" name="tags" value="13"> 학습지 13번</label>
        <label class="-box"><input type="checkbox" name="tags" value="14"> 학습지 14번</label>
        <label class="-box"><input type="checkbox" name="tags" value="15"> 학습지 15번</label>
        <label class="-box"><input type="checkbox" name="tags" value="16"> 학습지 16번</label>
    </div>
    <br>
    <div>
        <label>기간 선택 : <input type="number" id="startYear" min="1899" max="2000" value="1899"></label>
        <label> ~ <input type="number" id="endYear" min="1899" max="2000" value="2000"></label>
    </div>
    <br>
    <div>
        <button onclick="filter()">필터 적용</button>
    </div>
    <br>
    <div id="table-box">
        <div id="table"></div>
    </div>

    <script>
        let Data = [];
        let filtered = [];

        fetch("data.json")
            .then(response => response.json())
            .then(data => {
                Data = data;
                filtered = [...Data];
                renderTable(filtered);
            })
            .catch(error => {
                console.error('데이터 로드 실패:', error);
                document.getElementById('table').textContent = "데이터를 불러오는 데 실패했습니다.";
            });

        function padMonth(str) {
            const [y, m] = String(str).split(".");
            return m ? `${y}.${parseInt(m)}` : `${y}`;
        }

        function parseYearMonth(str) {
            const [y, m] = String(str).split(".");
            return {
                year: parseInt(y, 10),
                month: m !== undefined ? parseInt(m, 10) : 0
            };
        }

        function renderTable(data) {
            if (!data.length) {
                document.getElementById('table').innerHTML = "<div>해당 조건의 요소가 없습니다.</div>";
                return;
            }
            data.sort((a, b) => {
                const ay = parseYearMonth(a.year);
                const by = parseYearMonth(b.year);
                if (ay.year !== by.year) return ay.year - by.year;
                return ay.month - by.month;
            });

            let html = `<table>
        <tr>
            <th style="text-align:left; color:#66cc33;">연도</th>
            <th style="color:#66cc33;">사건</th>
            <th style="text-align:right; color:#66cc33;">학습지</th>
        </tr>`;
            data.forEach(item => {
                html += `<tr>
            <td style="text-align:left;">${padMonth(item.year)}</td>
            <td>${item.event || ""}</td>
            <td style="text-align:right;">${item.tags}</td>
        </tr>`;
            });
            html += `</table>`;
            document.getElementById('table').innerHTML = html;
        }

        function filter() {
            const checked = Array.from(document.querySelectorAll('input[name="tags"]:checked')).map(cb => cb.value);
            const startYear = document.getElementById('startYear').value;
            const endYear = document.getElementById('endYear').value;
            const startYearStr = startYear.includes('.') ? padMonth(startYear) : `${startYear}.00`;
            const endYearStr = endYear.includes('.') ? padMonth(endYear) : `${endYear}.12`;

            filtered = Data.filter(item => {
                const tagMatch = checked.length === 0 || checked.includes(String(item.tags));
                const y = padMonth(item.year);
                return tagMatch && y >= startYearStr && y <= endYearStr;
            });

            renderTable(filtered);
        }

        function getQueryParams() {
            const params = {};
            const searchParams = new URLSearchParams(location.search);
            for (const [key, value] of searchParams.entries()) {
                params[key] = value;
            }
            return params;
        }
        
        function goHome() {
            window.location.href = "index.html";
        }
    </script>
</body>

</html>